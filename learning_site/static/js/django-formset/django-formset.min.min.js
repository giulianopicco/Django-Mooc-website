var __hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c;d.__super__=b.prototype;return d};(function(a){var b;a.fn.djangoFormset=function(c){return new a.fn.djangoFormset.Formset(this,c)};b=function(c){__extends(d,c);function d(){return d.__super__.constructor.apply(this,arguments)}return d}(Error);a.fn.djangoFormset.Formset=function(){function c(i,g){var h,e,f,d;this.opts=a.extend({},a.fn.djangoFormset.defaultOptions,g);if(i.length===0){throw new b("Empty selector.")}this.template=i.filter("."+this.opts.formTemplateClass);if(this.template.length===0){throw new b("Can't find template (looking for ."+this.opts.formTemplateClass+")")}f=this.template.find("input,select,textarea").first().attr("name");if(!f){throw new b("Can't figure out form prefix because there's no form element in the form template. Please add one.")}d=f.indexOf("-__prefix__");if(d===-1){throw new b("Can't figure out form prefix from template because it doesn't contain '-__prefix__'.")}this.prefix=f.substring(0,d);this.totalForms=a("#id_"+this.prefix+"-TOTAL_FORMS");if(this.totalForms.length===0){throw new b("Management form field 'TOTAL_FORMS' not found for prefix "+this.prefix+".")}this._initTabs();e=i.not("."+this.opts.formTemplateClass);this.initialForms=e.length;a(this).on(this.opts.on);this.forms=e.map(function(j){return function(k,m){var l,o,n;if(j.hasTabs){n=a.djangoFormset.getTabActivator(m.id);o=new j.opts.tabClass(n.closest(".nav > *"))}l=new j.opts.formClass(a(m),j,k,o);a(j).trigger("formInitialized",[l]);return l}}(this));if(this.forms.length!==parseInt(this.totalForms.val())){console.error("TOTAL_FORMS is "+this.totalForms.val()+", but "+this.forms.length+" non-template elements found in passed selection.")}h=this.forms.filter(function(){return this.deleteInput.val()});h.each(function(){return this["delete"]()});this.insertAnchor=i.not("."+this.opts.formTemplateClass).last();if(this.insertAnchor.length===0){this.insertAnchor=this.template}return}c.prototype._initTabs=function(){var e,d;this.hasTabs=this.template.is(".tab-pane");if(!this.hasTabs){return}e=a.djangoFormset.getTabActivator(this.template.attr("id"));if(e.length===0){throw new b("Template is .tab-pane but couldn't find corresponding tab activator.")}d=e.closest(".nav");if(d.length===0){throw new b("Template is .tab-pane but couldn't find corresponding .nav.")}this.tabTemplate=d.children("."+this.opts.formTemplateClass);if(this.tabTemplate.length===0){throw new b("Tab nav template not found (looking for ."+this.opts.formTemplateClass+").")}};c.prototype.addForm=function(){var e,d,h,f,g;if(this.hasTabs){f=this.tabTemplate.clone().removeClass(this.opts.formTemplateClass);h=new this.opts.tabClass(f);if(this.forms.length>0){g=this.forms[this.forms.length-1].tab.elem}else{g=this.tabTemplate}f.insertAfter(g)}d=this.template.clone().removeClass(this.opts.formTemplateClass);e=new this.opts.formClass(d,this,parseInt(this.totalForms.val()),h);d.insertAfter(this.insertAnchor);this.insertAnchor=d;this.forms.push(e);this.totalForms.val(parseInt(this.totalForms.val())+1);if(this.hasTabs){h.activate()}a(this).trigger("formInitialized",[e]);a(this).trigger("formAdded",[e]);return e};c.prototype.deleteForm=function(d){var e;e=this.forms[d];e["delete"]()};c.prototype.handleFormRemoved=function(e){var g,f,j,d,h;this.totalForms.val(parseInt(this.totalForms.val())-1);this.forms.splice(e,1);h=this.forms;for(f=j=0,d=h.length;j<d;f=++j){g=h[f];g._updateFormIndex(f)}if(this.forms.length===0){this.insertAnchor=this.template}else{this.insertAnchor=this.forms[this.forms.length-1].elem}};return c}();a.fn.djangoFormset.Form=function(){function c(f,h,d,e){var g;this.elem=f;this.formset=h;this.index=d;this.tab=e;this.elem.data("djangoFormset.Form",this);if(this.index!==void 0){this._initFormIndex(this.index)}this.deleteInput=this.field("DELETE");g=this.index<this.formset.initialForms;if(this.deleteInput.length>0||!g){this._replaceDeleteCheckboxWithButton()}}c.prototype.getDeleteButton=function(){return a("<button type='button' class='btn btn-danger'> "+this.formset.opts.deleteButtonText+" </button>")};c.prototype.insertDeleteButton=function(){if(this.deleteInput.length>0){this.deleteInput.after(this.deleteButton)}else{(this.elem.is("TR")?this.elem.children().last():this.elem.is("UL")||this.elem.is("OL")?this.elem.append("li").children().last():this.elem).append(this.deleteButton)}};c.prototype["delete"]=function(){var e,d,f;e=this.index<this.formset.initialForms;if(this.deleteInput.length===0&&e){console.warn("Tried do delete non-deletable form "+this.formset.prefix+" #"+this.index+".");return}if(this.tab&&this.tab.elem.is(".active")){f=this.formset.forms.map(function(g,h){return h.tab.elem[0]});d=f.slice(this.index+1).filter(":visible").first();if(d.length===0){d=f.slice(0,this.index).filter(":visible").last()}if(d.length>0){d.data("djangoFormset.tab").activate()}}if(e){if(this.deleteInput.length>0){this.deleteInput.val("on")}if(this.tab){this.tab.elem.hide()}this.hide()}else{if(this.tab){this.tab.elem.remove()}this.elem.remove();this.formset.handleFormRemoved(this.index)}};c.prototype.hide=function(){return this.elem.hide()};c.prototype.field=function(d){return this.elem.find("[name='"+this.formset.prefix+"-"+this.index+"-"+d+"']")};c.prototype.prev=function(){var d,f,e;e=this.formset.forms.slice(0,+(this.index-1)+1||9e9);for(f=e.length-1;f>=0;f+=-1){d=e[f];if(d.elem.is(":visible")){return d}}};c.prototype._replaceDeleteCheckboxWithButton=function(){var e,d;if(this.deleteInput.length>0){d=a("<input type='hidden' name='"+this.deleteInput.attr("name")+"' id='"+this.deleteInput.attr("id")+"' value='"+(this.deleteInput.is(":checked")?"on":"")+"'/>");e=this.elem.find("label[for='"+this.deleteInput.attr("id")+"']");if(e.has(this.deleteInput).length>0){e.replaceWith(d)}else{e.remove();this.deleteInput.replaceWith(d)}this.deleteInput=d}this.deleteButton=this.getDeleteButton();this.deleteButton.on("click",function(f){return function(g){return f["delete"]()}}(this));this.insertDeleteButton()};c.prototype._replaceFormIndex=function(f,e){var g,h,d;this.index=e;h=new RegExp(""+this.formset.prefix+"-"+f);g=""+this.formset.prefix+"-"+e;d=function(o){var k,n,m,l,p,j,i;m={input:["id","name"],select:["id","name"],textarea:["id","name"],label:["for"],div:["id"],"*":["href","data-target"]};l=o.get(0).tagName;n=[];if(l.toLowerCase()in m){n=m[l.toLowerCase()]}n.push.apply(n,m["*"]);i=[];for(p=0,j=n.length;p<j;p++){k=n[p];if(o.attr(k)){i.push(o.attr(k,o.attr(k).replace(h,g)))}else{i.push(void 0)}}return i};d(this.elem);this.elem.find("input, select, textarea, label").each(function(){d(a(this))});if(this.tab){d(this.tab.elem);this.tab.elem.find("a, button").each(function(){d(a(this))})}};c.prototype._initFormIndex=function(d){this._replaceFormIndex("__prefix__",d)};c.prototype._updateFormIndex=function(d){this._replaceFormIndex("\\d+",d)};return c}();a.fn.djangoFormset.Tab=function(){function c(d){this.elem=d;this.elem.data("djangoFormset.tab",this)}c.prototype.activate=function(){return this.elem.find("[data-toggle='tab']").trigger("click")};c.prototype.remove=function(){return this.elem.remove()};return c}();a.fn.djangoFormset.defaultOptions={formTemplateClass:"empty-form",formClass:a.fn.djangoFormset.Form,tabClass:a.fn.djangoFormset.Tab,deleteButtonText:'<i class="fa fa-trash"></i>'};a.djangoFormset={getTabActivator:function(c){return a("[href='#"+c+"'], [data-target='#"+c+"']")}}})(jQuery);