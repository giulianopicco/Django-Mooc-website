var __hasProp={}.hasOwnProperty,__extends=function(f,e){function h(){this.constructor=f}for(var g in e){__hasProp.call(e,g)&&(f[g]=e[g])}return h.prototype=e.prototype,f.prototype=new h,f.__super__=e.prototype,f};!function(d){var c;d.fn.djangoFormset=function(a){return new d.fn.djangoFormset.Formset(this,a)},c=function(f){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,f),e}(Error),d.fn.djangoFormset.Formset=function(){function a(m,l){var k,j,i,b;if(this.opts=d.extend({},d.fn.djangoFormset.defaultOptions,l),0===m.length){throw new c("Empty selector.")}if(this.template=m.filter("."+this.opts.formTemplateClass),0===this.template.length){throw new c("Can't find template (looking for ."+this.opts.formTemplateClass+")")}if(i=this.template.find("input,select,textarea").first().attr("name"),!i){throw new c("Can't figure out form prefix because there's no form element in the form template. Please add one.")}if(b=i.indexOf("-__prefix__"),-1===b){throw new c("Can't figure out form prefix from template because it doesn't contain '-__prefix__'.")}if(this.prefix=i.substring(0,b),this.totalForms=d("#id_"+this.prefix+"-TOTAL_FORMS"),0===this.totalForms.length){throw new c("Management form field 'TOTAL_FORMS' not found for prefix "+this.prefix+".")}this._initTabs(),j=m.not("."+this.opts.formTemplateClass),this.initialForms=j.length,d(this).on(this.opts.on),this.forms=j.map(function(e){return function(q,p){var o,n,h;return e.hasTabs&&(h=d.djangoFormset.getTabActivator(p.id),n=new e.opts.tabClass(h.closest(".nav > *"))),o=new e.opts.formClass(d(p),e,q,n),d(e).trigger("formInitialized",[o]),o}}(this)),this.forms.length!==parseInt(this.totalForms.val())&&console.error("TOTAL_FORMS is "+this.totalForms.val()+", but "+this.forms.length+" non-template elements found in passed selection."),k=this.forms.filter(function(){return this.deleteInput.val()}),k.each(function(){return this["delete"]()}),this.insertAnchor=m.not("."+this.opts.formTemplateClass).last(),0===this.insertAnchor.length&&(this.insertAnchor=this.template)}return a.prototype._initTabs=function(){var e,b;if(this.hasTabs=this.template.is(".tab-pane"),this.hasTabs){if(e=d.djangoFormset.getTabActivator(this.template.attr("id")),0===e.length){throw new c("Template is .tab-pane but couldn't find corresponding tab activator.")}if(b=e.closest(".nav"),0===b.length){throw new c("Template is .tab-pane but couldn't find corresponding .nav.")}if(this.tabTemplate=b.children("."+this.opts.formTemplateClass),0===this.tabTemplate.length){throw new c("Tab nav template not found (looking for ."+this.opts.formTemplateClass+").")}}},a.prototype.addForm=function(){var g,k,j,i,h;return this.hasTabs&&(i=this.tabTemplate.clone().removeClass(this.opts.formTemplateClass),j=new this.opts.tabClass(i),h=this.forms.length>0?this.forms[this.forms.length-1].tab.elem:this.tabTemplate,i.insertAfter(h)),k=this.template.clone().removeClass(this.opts.formTemplateClass),g=new this.opts.formClass(k,this,parseInt(this.totalForms.val()),j),k.insertAfter(this.insertAnchor),this.insertAnchor=k,this.forms.push(g),this.totalForms.val(parseInt(this.totalForms.val())+1),this.hasTabs&&j.activate(),d(this).trigger("formInitialized",[g]),d(this).trigger("formAdded",[g]),g},a.prototype.deleteForm=function(f){var e;e=this.forms[f],e["delete"]()},a.prototype.handleFormRemoved=function(h){var g,l,k,j,i;for(this.totalForms.val(parseInt(this.totalForms.val())-1),this.forms.splice(h,1),i=this.forms,l=k=0,j=i.length;j>k;l=++k){g=i[l],g._updateFormIndex(l)}this.insertAnchor=0===this.forms.length?this.template:this.forms[this.forms.length-1].elem},a}(),d.fn.djangoFormset.Form=function(){function a(g,f,j,i){var h;this.elem=g,this.formset=f,this.index=j,this.tab=i,this.elem.data("djangoFormset.Form",this),void 0!==this.index&&this._initFormIndex(this.index),this.deleteInput=this.field("DELETE"),h=this.index<this.formset.initialForms,(this.deleteInput.length>0||!h)&&this._replaceDeleteCheckboxWithButton()}return a.prototype.getDeleteButton=function(){return d("<button type='button' class='btn btn-danger'> "+this.formset.opts.deleteButtonText+" </button>")},a.prototype.insertDeleteButton=function(){this.deleteInput.length>0?this.deleteInput.after(this.deleteButton):(this.elem.is("TR")?this.elem.children().last():this.elem.is("UL")||this.elem.is("OL")?this.elem.append("li").children().last():this.elem).append(this.deleteButton)},a.prototype["delete"]=function(){var f,e,g;return f=this.index<this.formset.initialForms,0===this.deleteInput.length&&f?void console.warn("Tried do delete non-deletable form "+this.formset.prefix+" #"+this.index+"."):(this.tab&&this.tab.elem.is(".active")&&(g=this.formset.forms.map(function(i,h){return h.tab.elem[0]}),e=g.slice(this.index+1).filter(":visible").first(),0===e.length&&(e=g.slice(0,this.index).filter(":visible").last()),e.length>0&&e.data("djangoFormset.tab").activate()),void(f?(this.deleteInput.length>0&&this.deleteInput.val("on"),this.tab&&this.tab.elem.hide(),this.hide()):(this.tab&&this.tab.elem.remove(),this.elem.remove(),this.formset.handleFormRemoved(this.index))))},a.prototype.hide=function(){return this.elem.hide()},a.prototype.field=function(b){return this.elem.find("[name='"+this.formset.prefix+"-"+this.index+"-"+b+"']")},a.prototype.prev=function(){var f,e,g;for(g=this.formset.forms.slice(0,+(this.index-1)+1||9e9),e=g.length-1;e>=0;e+=-1){if(f=g[e],f.elem.is(":visible")){return f}}},a.prototype._replaceDeleteCheckboxWithButton=function(){var e,f;this.deleteInput.length>0&&(f=d("<input type='hidden' name='"+this.deleteInput.attr("name")+"' id='"+this.deleteInput.attr("id")+"' value='"+(this.deleteInput.is(":checked")?"on":"")+"'/>"),e=this.elem.find("label[for='"+this.deleteInput.attr("id")+"']"),e.has(this.deleteInput).length>0?e.replaceWith(f):(e.remove(),this.deleteInput.replaceWith(f)),this.deleteInput=f),this.deleteButton=this.getDeleteButton(),this.deleteButton.on("click",function(b){return function(){return b["delete"]()}}(this)),this.insertDeleteButton()},a.prototype._replaceFormIndex=function(g,k){var j,i,h;this.index=k,i=new RegExp(""+this.formset.prefix+"-"+g),j=""+this.formset.prefix+"-"+k,h=function(l){var e,r,q,p,o,n,m;q={input:["id","name"],select:["id","name"],textarea:["id","name"],label:["for"],div:["id"],"*":["href","data-target"]},p=l.get(0).tagName,r=[],p.toLowerCase()in q&&(r=q[p.toLowerCase()]),r.push.apply(r,q["*"]),m=[];for(o=0,n=r.length;n>o;o++){e=r[o],m.push(l.attr(e)?l.attr(e,l.attr(e).replace(i,j)):void 0)}return m},h(this.elem),this.elem.find("input, select, textarea, label").each(function(){h(d(this))}),this.tab&&(h(this.tab.elem),this.tab.elem.find("a, button").each(function(){h(d(this))}))},a.prototype._initFormIndex=function(b){this._replaceFormIndex("__prefix__",b)},a.prototype._updateFormIndex=function(b){this._replaceFormIndex("\\d+",b)},a}(),d.fn.djangoFormset.Tab=function(){function b(e){this.elem=e,this.elem.data("djangoFormset.tab",this)}return b.prototype.activate=function(){return this.elem.find("[data-toggle='tab']").trigger("click")},b.prototype.remove=function(){return this.elem.remove()},b}(),d.fn.djangoFormset.defaultOptions={formTemplateClass:"empty-form",formClass:d.fn.djangoFormset.Form,tabClass:d.fn.djangoFormset.Tab,deleteButtonText:"Delete"},d.djangoFormset={getTabActivator:function(a){return d("[href='#"+a+"'], [data-target='#"+a+"']")}}}(jQuery);